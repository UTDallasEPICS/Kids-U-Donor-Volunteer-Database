generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DB_URL")
}

model Person {
  id             String          @id @default(uuid())
  firstName      String
  lastName       String
  emailAddress   String          @unique
  phoneNumber    String?         @unique
  donor          Donor?
  representative Representative?
  address        Address?
  user           User?
}

model User {
  id       String  @id @default(uuid())
  role     String
  personId String? @unique
  person   Person? @relation(fields: [personId], references: [id])
}

model Grantor {
  id                          String           @id @default(uuid())
  websiteLink                 String?
  addressId                   String
  name                        String           @unique
  contactTitle                String
  type                        String
  communicationPreference     String
  recognitionPreference       String
  internalRelationshipManager String
  representative              Representative[]
  address                     Address          @relation(fields: [id], references: [id])
}

model Representative {
  id                  String                @id @default(uuid())
  positionTitle       String
  personId            String                @unique
  grantorId           String
  person              Person                @relation(fields: [personId], references: [id])
  grantor             Grantor               @relation(fields: [grantorId], references: [id])
  representativeGrant RepresentativeGrant[]
}

model Grant {
  id                         String    @id @default(uuid())
  name                       String    @unique
  status                     String
  amountRequested            Float
  amountAwarded              Float
  purpose                    String
  startDate                  DateTime
  endDate                    DateTime
  isMultipleYears            Boolean
  quarter                    String
  proposalSubmissionDate     DateTime
  awardNotificationDate      DateTime
  fundingArea                String //specific area or general
  //
  internalProposalDueDate    DateTime?
  proposalDueDate            DateTime
  proposalSummary            String
  applicationType            String
  internalOwner              String
  requiredAttachment         String
  //
  fundingRestriction         String?
  matchingRequirement        String?
  useArea                    String //specific area or general
  //
  finalReportDueDate         String
  programImpact              String
  complianceRequirement      String
  isSiteVisitRequired        Boolean
  siteVisitDate              DateTime?
  //
  budgetAllocation           String
  totalExpensesIncurred      Float
  remainingBalance           Float
  auditRequirement           String?
  //
  isEligibleForRenewal       Boolean
  renewalApplicationDate     DateTime
  renewalAwardStatus         String
  futureFundingOpportunities String
  //
  programAlignment           String
  proposalReviewDate         DateTime
  reportReviewDate           DateTime

  representativeGrant RepresentativeGrant[]
  grantExpense        GrantExpense[]
  grantPurpose        GrantPurpose[]
}

model GrantPayment {
  id      String   @id @default(uuid())
  grantId String
  amount  Float
  date    DateTime
}

model GrantPurpose {
  id      String @id @default(uuid())
  grantId String
  purpose String
  grant   Grant  @relation(fields: [grantId], references: [id])
}

model GrantExpense {
  id          String @id @default(uuid())
  grantId     String
  amount      Float
  description String
  grant       Grant  @relation(fields: [grantId], references: [id])
}

model RepresentativeGrant {
  grantId          String
  representativeId String
  grant            Grant          @relation(fields: [grantId], references: [id])
  representative   Representative @relation(fields: [representativeId], references: [id])

  @@id([grantId, representativeId])
}

// Donation Related
model Donor {
  id                      String     @id @default(uuid())
  type                    String
  communicationPreference String
  status                  String
  notes                   String
  personId                String     @unique
  isRetained              Boolean
  segment                 String?
  donation                Donation[]
  person                  Person     @relation(fields: [personId], references: [id])
}

model Address {
  id           String    @id @default(uuid())
  addressLine1 String
  addressLine2 String
  city         String
  state        String
  zipCode      String
  type         String
  personId     String    @unique
  person       Person    @relation(fields: [personId], references: [id])
  Grantor      Grantor[]
}

model Donation {
  id                  String   @id @default(uuid())
  type                String
  amount              Float?
  item                String?
  paymentMethod       String? //expand
  campaign            String
  date                DateTime
  fundDesignation     String
  recurringFrequency  String?
  source              String
  isMatching          Boolean
  donorId             String   @unique
  receiptSent         Boolean
  receiptNumber       String   @default(uuid())
  isAnonymous         Boolean
  acknowledgementSent Boolean
  donor               Donor    @relation(fields: [donorId], references: [id])
}
